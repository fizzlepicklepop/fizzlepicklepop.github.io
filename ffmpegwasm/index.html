<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ffmpeg.wasm on GitHub Pages (COEP/COOP via SW)</title>

  <!-- Cross-origin isolation via service worker -->
  <script src="coi-serviceworker.min.js"></script>

  <style>
    :root { --bg:#0b0f14; --fg:#e6eef8; --muted:#9bb0c7; --accent:#4aa3ff; }
    html,body { height:100%; margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, sans-serif; background:var(--bg); color:var(--fg); }
    .wrap { max-width: 860px; margin: 2rem auto; padding: 0 1rem; }
    h1 { font-size: 1.6rem; margin: 0 0 1rem; }
    .card { background: #0f141b; border: 1px solid #1b2532; border-radius: 16px; padding: 1rem; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .row > *:only-child { grid-column: 1 / -1; }
    label { display:block; font-size: .9rem; color: var(--muted); margin-bottom:.25rem; }
    input[type="file"], select, button, input[type="number"] {
      width:100%; padding:.75rem; border-radius:12px; border:1px solid #243144; background:#0b0f14; color:var(--fg);
    }
    button { background: var(--accent); color:black; font-weight:600; border:none; cursor:pointer; }
    button:disabled { opacity:.5; cursor:not-allowed; }
    progress { width: 100%; height: 14px; }
    .log { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
           background: #0a0e13; border:1px solid #1b2532; border-radius:12px; padding:.75rem; height:180px; overflow:auto; white-space:pre-wrap; }
    .pill { display:inline-block; padding:.2rem .5rem; border-radius:999px; background:#122033; border:1px solid #1b2a42; color:var(--muted); font-size:.8rem; }
    a.download { color: var(--accent); text-decoration: none; font-weight: 600; }
    .footer { opacity:.7; font-size:.9rem; margin-top:1rem; }
    .ok { color:#50fa7b }
    .warn { color:#ffb86c }
    .bad { color:#ff6b6b }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ffmpeg.wasm (multi‑threaded) on GitHub Pages</h1>
    <div class="card">
      <div class="row">
        <div>
          <label for="file">Source video</label>
          <input id="file" type="file" accept="video/*" />
        </div>
        <div>
          <label for="format">Output format</label>
          <select id="format">
            <option value="mp4">MP4 (H.264 + AAC)</option>
            <option value="webm">WebM (VP9 + Opus)</option>
            <option value="mkv">MKV (H.264 + AAC)</option>
          </select>
        </div>
        <div>
          <label for="crf">CRF (quality, lower = better)</label>
          <input id="crf" type="number" min="16" max="35" step="1" value="23" />
        </div>
        <div>
          <label for="preset">Preset (speed)</label>
          <select id="preset">
            <option>veryfast</option>
            <option>faster</option>
            <option>fast</option>
            <option selected>medium</option>
            <option>slow</option>
            <option>slower</option>
          </select>
        </div>
        <div>
          <label>Progress</label>
          <progress id="progress" max="1" value="0"></progress>
        </div>
        <div>
          <label>Status</label>
          <div id="status" class="pill">idle</div>
        </div>
        <div>
          <button id="start">Transcode</button>
        </div>
        <div>
          <a id="download" class="download" href="#" download style="display:none;">Download output</a>
        </div>
        <div class="row" style="grid-column:1/-1;">
          <label>Log</label>
          <div id="log" class="log"></div>
        </div>
        <div class="row" style="grid-column:1/-1;">
          <div class="footer">
            <div>Cross‑origin isolated: <span id="coi" class="pill">checking…</span></div>
            <div>Tip: keep everything same‑origin (no external fonts/scripts) under COEP.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="./js/app.js"></script>
</body>
</html>
