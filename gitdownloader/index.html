<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Git SSH → ZIP Downloader (Single File)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { color-scheme: light dark; }
    @media (prefers-color-scheme: dark) {
      body { background: #0b1220; color: #e5e7eb; }
    }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800">
  <header class="max-w-3xl mx-auto p-6">
    <h1 class="text-3xl font-bold">Git SSH → ZIP Downloader</h1>
    <p class="mt-2 text-slate-600">Paste a repo URL like
      <code class="px-1 py-0.5 bg-slate-200 rounded">git@bitbucket.org:gir489/bioshock2crashfix.git</code>
      and click <strong>Generate</strong>. You’ll get direct ZIP links.
    </p>
  </header>

  <main class="max-w-3xl mx-auto p-6">
    <div class="bg-white rounded-2xl shadow p-6 space-y-4">
      <label class="block">
        <span class="text-sm font-medium text-slate-700">Repo URL (SSH or HTTPS)</span>
        <input id="repoInput"
               class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-2 focus:outline-none focus:ring-4 focus:ring-indigo-200"
               value="git@bitbucket.org:gir489/bioshock2crashfix.git"
               placeholder="e.g. git@github.com:owner/repo.git" />
      </label>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <label class="block">
          <span class="text-sm font-medium text-slate-700">Branch/Tag (optional)</span>
          <input id="refInput"
                 class="mt-1 w-full rounded-xl border border-slate-300 px-4 py-2 focus:outline-none focus:ring-4 focus:ring-indigo-200"
                 placeholder="e.g. main, master, v1.2.3" />
        </label>

        <label class="block">
          <span class="text-sm font-medium text-slate-700">Provider (auto-detected)</span>
          <input id="providerOutput" disabled
                 class="mt-1 w-full rounded-xl border border-slate-200 bg-slate-100 px-4 py-2"
                 placeholder="—" />
        </label>
      </div>

      <div class="flex items-center gap-3">
        <button id="genBtn"
                class="rounded-xl bg-indigo-600 text-white px-4 py-2 font-medium hover:bg-indigo-500 active:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-200">
          Generate
        </button>
        <button id="clearBtn" class="rounded-xl bg-slate-200 text-slate-800 px-3 py-2 font-medium hover:bg-slate-300">
          Clear
        </button>
      </div>

      <div id="note" class="hidden rounded-xl border border-amber-300 bg-amber-50 p-4 text-amber-800 text-sm"></div>
      <div id="results" class="space-y-3"></div>

      <details class="pt-2">
        <summary class="cursor-pointer text-sm text-slate-600">Why can’t a webpage clone via SSH?</summary>
        <div class="mt-2 text-sm text-slate-600">
          Browsers cannot access your SSH keys or run the git protocol. This tool rewrites supported URLs to the host’s
          official ZIP archive endpoints. Private repos require that you’re signed in on the host or that a backend signs
          the request (not included here).
        </div>
      </details>
    </div>

    <footer class="text-xs text-slate-500 mt-6">
      Pure static HTML/JS • Public repos only unless you’re already authenticated on the host.
    </footer>
  </main>

<script>
const $ = (sel) => document.querySelector(sel);
const repoInput = $("#repoInput");
const refInput = $("#refInput");
const providerOutput = $("#providerOutput");
const results = $("#results");
const note = $("#note");

function parseGitUrl(input) {
  const s = (input || "").trim();
  if (!s) return null;

  // SSH: git@host:owner/repo(.git)
  const ssh = s.match(/^git@([^:]+):(.+?)(?:\.git)?$/i);
  if (ssh) {
    return { host: ssh[1].toLowerCase(), path: ssh[2].replace(/\.git$/i, "") };
  }

  // HTTPS: https://host/owner/repo(.git)
  try {
    const u = new URL(s);
    if (u.protocol === "http:" || u.protocol === "https:") {
      const host = u.host.toLowerCase();
      let path = u.pathname.replace(/^\//, "").replace(/\.git$/i, "");
      return { host, path };
    }
  } catch (e) { /* not a URL */ }

  return null;
}

function detectProvider(host) {
  if (!host) return null;
  if (host.endsWith("github.com")) return "github";
  if (host.endsWith("gitlab.com")) return "gitlab";
  if (host.endsWith("bitbucket.org")) return "bitbucket";
  return null;
}

function buildArchiveLinks(parsed, refOpt) {
  const { host, path } = parsed;
  const provider = detectProvider(host);
  if (!provider) {
    return { provider: null, links: [], tips: ["Unsupported host. Supported: GitHub, GitLab, Bitbucket."] };
  }

  const parts = path.split("/");
  const owner = parts[0];
  const repo = parts[parts.length - 1];
  const groupPath = parts.slice(0, -1).join("/");
  const ref = (refOpt || "").trim();

  const L = (label, href, hint="") => ({ label, href, hint });

  if (provider === "github") {
    // If ref provided, prefer codeload
    const links = [];
    if (ref) {
      links.push(L("Download (codeload)", `https://codeload.github.com/${owner}/${repo}/zip/refs/heads/${ref}`));
      links.push(L("Download (GitHub API)", `https://api.github.com/repos/${owner}/${repo}/zipball/${ref}`));
    } else {
      // Without ref, zipball uses default branch
      links.push(L("Download (GitHub API, default branch)", `https://api.github.com/repos/${owner}/${repo}/zipball`));
    }
    const tips = ref ? [] : ["No branch/tag provided — using the repository’s default branch."];
    return { provider, links, tips };
  }

  if (provider === "gitlab") {
    const guessed = ref || "main";
    const links = [
      L("Download (GitLab)", `https://gitlab.com/${groupPath}/${repo}/-/archive/${guessed}/${repo}-${guessed}.zip`, ref ? "" : "Guessing ref=main; try master.")
    ];
    if (!ref) {
      links.push(L("Try master", `https://gitlab.com/${groupPath}/${repo}/-/archive/master/${repo}-master.zip`));
    }
    return { provider, links, tips: ["Enter a branch/tag if guessing fails."] };
  }

  if (provider === "bitbucket") {
    const guessed = ref || "master";
    const links = [
      L("Download (Bitbucket)", `https://bitbucket.org/${owner}/${repo}/get/${guessed}.zip`, ref ? "" : "Guessing ref=master; try main.")
    ];
    if (!ref) {
      links.push(L("Try main", `https://bitbucket.org/${owner}/${repo}/get/main.zip`));
      links.push(L("Repo downloads page", `https://bitbucket.org/${owner}/${repo}/downloads/`, "If direct links 404, check here."));
    }
    return { provider, links, tips: ["Bitbucket often needs an explicit branch/tag."] };
  }

  return { provider: null, links: [], tips: [] };
}

function renderResults(data) {
  results.innerHTML = "";
  note.classList.add("hidden");
  providerOutput.value = data.provider ? data.provider : "—";

  if (!data.provider) {
    note.textContent = (data.tips && data.tips[0]) || "Unsupported host.";
    note.classList.remove("hidden");
    return;
  }

  if (!data.links.length) {
    note.textContent = "Couldn’t build links. Check the URL or add a branch/tag.";
    note.classList.remove("hidden");
    return;
  }

  if (data.tips?.length) {
    const n = document.createElement("div");
    n.className = "rounded-xl border border-amber-300 bg-amber-50 p-3 text-sm text-amber-800";
    n.textContent = data.tips.join(" ");
    results.appendChild(n);
  }

  data.links.forEach((lnk) => {
    const a = document.createElement("a");
    a.href = lnk.href;
    a.target = "_blank";
    a.rel = "noopener noreferrer";
    a.className = "block w-full text-left rounded-xl border border-slate-300 bg-white hover:bg-slate-50 px-4 py-3";
    a.innerHTML = `<div class="font-medium">${lnk.label}</div>
                   <div class="text-xs text-slate-500 break-all">${lnk.href}</div>`;
    if (lnk.hint) a.title = lnk.hint;
    results.appendChild(a);
  });
}

function generate() {
  const parsed = parseGitUrl(repoInput.value);
  if (!parsed) {
    note.textContent = "Enter a valid SSH or HTTPS repository URL.";
    note.classList.remove("hidden");
    results.innerHTML = "";
    providerOutput.value = "—";
    return;
  }

  const provider = detectProvider(parsed.host);
  providerOutput.value = provider || "—";

  const data = buildArchiveLinks(parsed, refInput.value);
  renderResults(data);
}

document.addEventListener("DOMContentLoaded", () => {
  // Auto-generate once on load so users immediately see output
  generate();
});

$("#genBtn").addEventListener("click", generate);

$("#clearBtn").addEventListener("click", () => {
  repoInput.value = "";
  refInput.value = "";
  providerOutput.value = "—";
  results.innerHTML = "";
  note.classList.add("hidden");
});

repoInput.addEventListener("input", () => {
  const parsed = parseGitUrl(repoInput.value || "");
  providerOutput.value = parsed ? (detectProvider(parsed.host) || "—") : "—";
});
</script>
</body>
</html>
